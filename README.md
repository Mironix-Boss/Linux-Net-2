# Linux-Net-2Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

ip addres show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:73:60:cf brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic eth0
       valid_lft 86149sec preferred_lft 86149sec
    inet6 fe80::a00:27ff:fe73:60cf/64 scope link
       valid_lft forever preferred_lft forever

ip -c -br link

lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
eth0             UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP>




Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

Для Cisco - CDP
conf t 
cdp enable
show cdp neighbors

в Linux - LLDP
apt get-install lldp
conf t 
lldp run
show lldp



Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

Технология VLAN 802.1Q
Проверяем пакет: lsmod | grep 8021q
Если нет то скачиваем: modprobe 8021q
Начинаем конфигурировать добавлением строк: $ sudo nano /etc/network/interfaces

##vlan ID-200 eth0 ##
auto eth0.200
iface eth0.200 inet static
address 192.168.1.200
netmask 255.255.255.0
vlan-raw-device eth0

Перезапускаем службу: systemctl restart network


Какие типы агрегации интерфейсов есть в Linux? 
Какие опции есть для балансировки нагрузки? 
Приведите пример конфига.


Типы агрегации интерфейсов в Linux:

Mode-0(balance-rr) – режим по умолчанию. Обеспечивает балансировку нагрузки и отказоустойчивость. Сетевые пакеты отправляются “по кругу”, от первого интерфейса к последнему. При отсутствии работы интерейсов, пакеты отправляются на остальные оставшиеся интерфейсы. Дополнительной настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах требуется дополнительная настройка.

Mode-1(active-backup) – Один из интерфейсов работает в активном режиме, остальные в ожидающем. При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс. Не требуется поддержки от коммутатора.

Mode-2(balance-xor) – Передача пакетов распределяется по типу входящего и исходящего трафика по формуле ((MAC src) XOR (MAC dest)) % число интерфейсов. Режим дает балансировку нагрузки и отказоустойчивость. Не требуется дополнительной настройки коммутатора/коммутаторов.

Mode-3(broadcast) – Происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость. Рекомендуется только для использования MULTICAST трафика.

Mode-4(802.3ad) – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка коммутатора/коммутаторов.

Mode-5(balance-tlb) – Адаптивная балансировки нагрузки трафика. Входящий трафик получается только активным интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

Mode-6(balance-alb) – Адаптивная балансировка нагрузки. Отличается более совершенным алгоритмом балансировки нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего так и входящего трафика. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.



config

1. Установить модуль ядра для поддержки объединения портов - sudo modprobe bonding
2. Обьединяем интерфейсы
$ sudo ip link add bond0 type bond mode 802.3ad
$ sudo ip link set eth0 master bond0
$ sudo ip link set eth1 master bond0
3. Редактируем конфигурационный файл /etc/network/interfaces
Прмер конфига 
# The primary network interface
auto bond0
iface bond0 inet static
    address 192.168.1.150
    netmask 255.255.255.0    
    gateway 192.168.1.1
    dns-nameservers 192.168.1.1 8.8.8.8
    dns-search domain.local
        slaves eth0 eth1
        bond_mode 0
        bond-miimon 100
        bond_downdelay 200
        bound_updelay 200
		
4. Перезапускаем службу - sudo systemctl restart networking.service или sudo ifdown eth0 && ifdown eth1 && ifup bond0

Проверяем интерфейсы - ifconfig или ip addr

Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

С маской 29 (6 ip для хостов + (Адрес сети и бродкаст)
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   192.168.1.0/29       11000000.10101000.00000001.00000 000
HostMin:   192.168.1.1          11000000.10101000.00000001.00000 001
HostMax:   192.168.1.6          11000000.10101000.00000001.00000 110
Broadcast: 192.168.1.7          11000000.10101000.00000001.00000 111
Hosts/Net: 6                     Class C, Private Internet

Из сети с маской /24 можно получить - 32 подсети с маской 29.

Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet

Network:   10.10.10.8/29        00001010.00001010.00001010.00001 000
HostMin:   10.10.10.9           00001010.00001010.00001010.00001 001
HostMax:   10.10.10.14          00001010.00001010.00001010.00001 110
Broadcast: 10.10.10.15          00001010.00001010.00001010.00001 111
Hosts/Net: 6                     Class A, Private Internet

Network:   10.10.10.16/29       00001010.00001010.00001010.00010 000
HostMin:   10.10.10.17          00001010.00001010.00001010.00010 001
HostMax:   10.10.10.22          00001010.00001010.00001010.00010 110
Broadcast: 10.10.10.23          00001010.00001010.00001010.00010 111
Hosts/Net: 6                     Class A, Private Internet

Network:   10.10.10.24/29       00001010.00001010.00001010.00011 000
HostMin:   10.10.10.25          00001010.00001010.00001010.00011 001
HostMax:   10.10.10.30          00001010.00001010.00001010.00011 110
Broadcast: 10.10.10.31          00001010.00001010.00001010.00011 111
Hosts/Net: 6                     Class A, Private Internet

Network:   10.10.10.32/29       00001010.00001010.00001010.00100 000
HostMin:   10.10.10.33          00001010.00001010.00001010.00100 001
HostMax:   10.10.10.38          00001010.00001010.00001010.00100 110
Broadcast: 10.10.10.39          00001010.00001010.00001010.00100 111
Hosts/Net: 6                     Class A, Private Internet

Network:   10.10.10.40/29       00001010.00001010.00001010.00101 000
HostMin:   10.10.10.41          00001010.00001010.00001010.00101 001
HostMax:   10.10.10.46          00001010.00001010.00001010.00101 110
Broadcast: 10.10.10.47          00001010.00001010.00001010.00101 111
Hosts/Net: 6                     Class A, Private Internet

Network:   10.10.10.48/29       00001010.00001010.00001010.00110 000
HostMin:   10.10.10.49          00001010.00001010.00001010.00110 001
HostMax:   10.10.10.54          00001010.00001010.00001010.00110 110
Broadcast: 10.10.10.55          00001010.00001010.00001010.00110 111
Hosts/Net: 6                     Class A, Private Internet

................




Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

Используем диапозон сетей 100.64.0.0 - 100.127.255.255 выбрав маску \26

Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

arp -a Покажет всю таблицу.
arp -a -d Удалит всю таблицу.
arp -d 192.168.1.2 удалит выбранный адрес из таблицы.
